# 用户系统需求文档

## 1. 系统架构
- 基于 Next.js 框架
- 采用 Edge Runtime 运行环境
- 使用 Cloudflare Pages 部署
- 使用 PostgreSQL 作为数据库
- 使用 Prisma 作为 ORM 框架
- 使用 Auth.js 实现认证

## 2. 用户认证系统

### 2.1 认证方式
支持多种登录方式:
- 邮箱账号登录
- 手机号验证码登录
- 第三方OAuth登录(支持多个提供商)
  - 支持 provider_account_id 唯一标识
  - 支持 access_token 和 refresh_token
  - 支持 token 过期管理

### 2.2 账号安全
- 密码加密存储
- 登录失败次数限制
- 账号锁定机制
- 设备管理(记录登录设备)
- 会话管理
  - session_token 唯一标识
  - 支持会话过期
  - 记录用户代理和IP

### 2.3 验证功能
- 邮箱验证
- 手机号验证
- 密码重置
- 验证令牌管理

## 3. 用户信息管理

### 3.1 基础信息
- 用户名
- 昵称
- 邮箱(唯一)
- 手机号(唯一)
- 头像
- 性别(MALE/FEMALE/OTHER)
- 生日
- 个人简介

### 3.2 用户状态
- ACTIVE: 正常
- INACTIVE: 未激活
- LOCKED: 锁定
- BANNED: 封禁

### 3.3 用户配置
- 支持自定义配置(JSON格式)
- 配置版本控制
- 记录配置修改历史

## 4. 会员系统

### 4.1 会员套餐
- 支持多语言(国际化)
- 套餐基本信息
  - 计划代码(用于关联不同语言版本)
  - 名称
  - 语言标识(如: zh-CN, en-US)
  - 价格(以分为单位)
  - 有效期(天)
  - 描述
  - 权益列表(JSON格式)
- 套餐状态管理
  - 启用/禁用控制
  - 排序管理

### 4.2 会员订阅
- 订阅状态管理
  - ACTIVE: 生效中
  - EXPIRED: 已过期
  - CANCELLED: 已取消
- 订阅期限管理
  - 开始时间
  - 结束时间
- 关联会员套餐

## 5. 审计日志
所有关键模型都需要记录:
- 创建时间
- 更新时间
- 必要的版本控制

## 6. 性能优化
- 合理的索引设计
  - 邮箱索引
  - 手机号索引
  - 状态索引
  - 会员相关索引
- 关联删除策略(Cascade)
- 唯一约束控制

## 7. 数据安全
- 敏感信息加密
- 密码安全存储
- 会话安全控制
- 验证令牌管理